# Bash

## 常用指令

| 指令                  | 参数（按顺序，中文逗号分隔）                                 | 作用                                                         | 例子                         |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ---------------------------- |
| `echo`                |                                                              | 输出后面跟随的语句                                           | `echo hello world`           |
| `pwd`                 | ---                                                          | 显示当前工作目录                                             | `pwd`                        |
| `echo $PATH`          | ---                                                          | 显示系统环境变量(绝对路径)                                   | `echo $PATH`                 |
| `date`                | ---                                                          | 显示日期                                                     | `date`                       |
| `cd`                  | 绝对或相对路径                                               | 切换工作目录                                                 | `cd /usr`                    |
| `which`               | 一个可以被bash直接调用的程序                                 | 显示该程序被调用时的实际路径(绝对路径)                       | `which echo`                 |
| `ls`                  | 一个路径（默认为当前工作目录）                               | 列出该路径下的所有文件和目录                                 | `ls`                         |
| `cd -`                | ---                                                          | 切换到上一次切换工作目录前的工作目录                         | `cd -`                       |
| `ls -l`               | 一个路径（默认为当前工作目录）                               | 列出该路径下的所有文件和目录及其详细信息                     | `ls -l`                      |
| `mv`                  | 原路径，新路径（不需要在同一目录下）                         | 改变文件的位置或重命名它（可以同时进行）                     | `mv dotfiles.md foo.md`      |
| `cp`                  | 源文件路径，新文件路径<br>（不需要在同一目录下）             | 复制一个文件，可以更改名字                                   | `cp dotfiles.md ../food.md ` |
| `rm`                  | 一个路径                                                     | 删除该**文件**                                               | `rm dotfiles.md`             |
| `rm -r`               | 一个路径                                                     | 删除该目录及其下的所有目录和文件                             | `rm -r data`                 |
| `rmdir`               | 一个路径                                                     | 删除该目录，要求该目录为空                                   | `rmdir data`                 |
| `mkdir`               | 一个路径                                                     | 创建目录                                                     | `mkdir data`                 |
| `man`                 | 一个程序                                                     | 显示该程序的手册页（通常比`--help`更易读且详细）             | `man ls`                     |
| 键盘点击Ctrl L        | ---                                                          | 清空屏幕                                                     | ---                          |
| `cat`                 | 一个或更多路径                                               | 连接文件并输出到标准输出                                     | `cat file1 file2`            |
| `tail`                | 一个或多个文件                                               | 输出每个文件的最后十行                                       | `tail dotfiles`              |
| `tail -nk`，`k`为数字 | 一个或多个文件                                               | 输出每个文件的最后 $k$ 行                                    | `tail -n1 file1`             |
| `tee`                 | 一个输入和一个文件的路径                                     | 将输入写入文件，同时显示在屏幕上                             | `tee 1060 dotfiles.md`       |
| `sudo su`             | ---                                                          | 切换到`root`用户（`exit`以返回）                             | `sudo su`                    |
| `xdg-open`            | 一个文件路径                                                 | 以用户希望(prefer)的方式打开文件                             | `xdg-open dotfiles.md`       |
| `touch`               | 一个文件路径<br>常有更多参数，默认更改为当前时间<br>https://zh.wikipedia.org/wiki/Touch_(Unix) | 更改文件的时间戳或创建特定时间戳的文件                       | `touch myfile.txt`           |
| `chmod`               | 符号或八进制表示的权限信息，文件路径                         | 改变文件的权限信息<br/>权限信息见https://zh.wikipedia.org/wiki/Chmod | `chomd u+x file.txt`         |
| `grep`                | 关键词，一个路径                                             | 如果路径是文件，输出文件中包含关键词的所有行<br>默认分大小写<br>如果使用标志`-R`且路径是目录，<br>将递归地搜索目录下所有文件的内容 | `grep apple fruitlist.txt`   |
| `source`              | 脚本路径                                                     | 在Bash中执行(execute)该脚本并加载(load)它                    | `source mcd.sh`              |
| `find`                | 见第二课                                                     | 查找文件并进行操作                                           | 见第二课                     |
| `tree`                | ---                                                          | 用树的方式列出文件夹结构                                     | `tree`                       |

查看安装的包（按时间排序）`zgrep 'install ' /var/log/dpkg.log* | sort | cut -f1,2,4 -d' '`

**2021年8月9日：**

* 已经安装 `man` 的中文包，现在 `man` 访问的是中文帮助信息
* 通过自定义配置文件，用 `eman` 可以访问原英文帮助信息 

## 规则

### 帮助信息

* `exe --help`显示程序exe的帮助信息
* 如`date --help`，`ls --help`
* 注意`echo --help`会直接返回`--help`
* 帮助信息中
  * `...`表示零个或一个或更多
  * 方括号表示可选
  * 例如`Usage: ls [OPTION]... [FILE]...`表示可选的多个选项和多个文件

### 路径

* `/`为路径分隔符，单独的`/`表示根目录
* `.`表示当前工作目录
* `..`表示父目录，通过`cd ..`返回父目录，可以使用类似`cd ../../../..`的指令返回上层目录
* 绝对地址以`/`开头，如`/home/cmj`
* 相对地址以`./`开头，如`./cmj`，可以省略`./`
* `~`表示`/home`目录，在WSL中是`/home/cmj`（cmj为用户名）

### `ls -l`给出的文件详细信息解读

以`drwxr-xr-x 1 root root 4096 Jul 27 11:04 bin`为例

* 第一个元素`drwxr-xr-x`：
  * 第一个字母`d`表示它是一个目录(directory)，若为文件此处是`-`
  * 接下来由三组字母组成，表示权限，每组都是`rwx`，其中一些字母被`-`替代
    * `r`表示读取文件的权限(read)或查看目录的权限
    * `w`表示写文件的权限(write)或对目录中文件进行重命名、创建、删除的权限（如果你有对文件的写权限而没有对其目录的写权限，你不能删除文件，但可以清空里面的内容）
    * `x`表示执行文件的权限(execute)或在目录中搜索的权限（`cd`到一个目录需要对该目录及其所有父目录有搜索权限）
    * 如果原有的字母被`-`替代，那么代表没有这项权限
    * 第一组字母表示文件所有者（或“用户所有者”）所具有的权限
    * 第二组字母表示文件所有者的组（或“组所有者”）所具有的权限
    * 第三组字母表示其他人所具有的权限
* 第二个元素表示文件的硬链接数
* 第三个元素`root`表示它的所有者是root
* 第四个元素`root`表示它的所属用户组是root
* 第五个元素`4096`表示它的大小是4096个字节
* 第六、七、八个元素是它的最后修改时间
* 第九个元素是文件名或目录名

### 参数

如果参数中含有空格，用`/`转义空格或使用字符串

如`mkdir My/ Photos`或`mkdir "My Photo"`将创建目录`My Photo`

* `mkdir My Photo`将创建两个目录`My`和`Photo`

### 输入输出流

`>`将把程序的输出重定向到`>`后的文件中（覆盖）

* 如`echo hello > hello.txt`将`hello`写入文件`hello.txt`，控制台将没有输出

`<`将把程序的输入重定向到`<`后的文件中

* 如`cat < hello.txt >hello2.txt`将把hello.txt里的内容复制到hello2.txt

`>>`将把程序的输出重定向到`>>`后的文件中（添加到尾部）

`|`把其左边的程序的输出作为右边程序的输入，这称为管道（pipes）

* 如`ls -l data | tail -n1`显示`ls`输出的最后一行

`<()`将括号内命令的输出装入一个临时文件并作为一个参数

* 如`cat <(ls) <(ls ..)`合并了两个`ls`命令的输出结果

### WSL专属

windows中C,D盘的文件存储在`/mnt/c`，`/mnt/d`中

## sudo与root

在命令的前面加上`sudo`来以`root`的身份执行命令

这允许你具有读、写、执行任何文件和目录的权力，且可以运行一些特别的指令

### `/sys`目录

`/sys`实际上不是一个文件目录，而是一个以文件目录的形式展现的系统内核，可以访问内核参数

执行`cd /sys`以进入该目录（这一步不需要`sudo`）

建议不要乱改里面的文件

### 变更为root用户

执行指令`sudo su`

此时注意到命令前的符号从`$`改变为`#`

执行`exit`以退回原用户

### sudo与管道

将`sudo`加在一行含管道的命令前只能以`root`身份执行第一个`|`前的命令，应当在所有需要`root`权限的命令前加`sudo`

假设`brightness`是一个内核文件：

* `sudo echo 3 > brightness`将被拒绝：`Permission denied`
* 我们可以操作`echo 3 | sudo tee brightness`



